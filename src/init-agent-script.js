📦
6314 /src/init-agent-script.js.map
4054 /src/init-agent-script.js
✄
{"version":3,"file":"init-agent-script.js","names":["wxOffsets","WX_LOGIN_URL_OFFSET","WX_LOGOUT_OFFSET","WX_ACCOUNT_SERVICE_OFFSET","WX_GET_APP_DATA_SAVE_PATH_OFFSET","WX_GET_CURRENT_DATA_PATH_OFFSET","WX_RECV_MSG_HOOK_OFFSET","WX_RECV_MSG_HOOK_NEXT_OFFSET","WX_SNS_HOOK_OFFSET","WX_SNS_HOOK_NEXT_OFFSET","moduleBaseAddress","Module","getBaseAddress","load","retidPtr","retidStruct","initidStruct","str","Memory","alloc","length","writeUtf16String","writePointer","add","writeU32","retPtr","retStruct","initStruct","readWideString","address","addr","ptr","size","readU32","capacity","readPointer","_readUtf16String","readUtf16String","readWStringPtr","isLoggedInFunction","success","accout_service_addr","service_addr","NativeFunction","callFunction","isNull","e","Error","nativeCallback","NativeCallback","nativeativeFunction","Interceptor","attach","onLeave","retval","isLoggedIn","console","log","setImmediate","checkLoginStatus","setTimeout","onEnter","args","toInt32","bySrv","error","isReady","memberNickBuffAsm","nickRoomId","nickMemberId","nickBuff","memberId","roomId","Process","pageSize","patchCode","code","cw","X86Writer","pc","putPushfx","putPushax","putMovRegAddress","putMovRegReg","putPushReg","putCallAddress","putAddRegImm","putPopax","putPopfx","putRet","flush","getChatroomMemberNickInfoFunction","this","context","ecx","msgType","isMyMsg","talkerIdPtr","talkerIdLen","myTalkerIdPtr","copy","contentPtr","contentLen","myContentPtr","thumbPtr","hdPtr","thumbPath","hdPath","picData","content","JSON","stringify","allocUtf16String","groupMsgAddr","myGroupMsgSenderIdPtr","groupMsgSenderIdPtr","groupMsgSenderIdLen","xmlNullPtr","myXmlContentPtr","xmlContentPtr","xmlContentLen"],"sourceRoot":"C:/Users/Administrator/Documents/GitHub/frida-agent-example/src/","sources":["init-agent-script.ts"],"mappings":"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"}
✄
const e={WX_LOGIN_URL_OFFSET:50597352,WX_LOGOUT_OFFSET:15042672,WX_ACCOUNT_SERVICE_OFFSET:7769216,WX_GET_APP_DATA_SAVE_PATH_OFFSET:15967760,WX_GET_CURRENT_DATA_PATH_OFFSET:13136576},t={WX_RECV_MSG_HOOK_OFFSET:13736459,WX_RECV_MSG_HOOK_NEXT_OFFSET:7694688,WX_SNS_HOOK_OFFSET:21995029,WX_SNS_HOOK_NEXT_OFFSET:21995680},r=Module.getBaseAddress("WeChatWin.dll");Module.load("WeChatWin.dll");let o=null,n=null;const d=e=>(o=Memory.alloc(2*e.length+1),o.writeUtf16String(e),n=Memory.alloc(20),n.writePointer(o).add(4).writeU32(2*e.length).add(4).writeU32(2*e.length).add(4).writeU32(0).add(4).writeU32(0),n);let a=null,i=null;const l=e=>(a=Memory.alloc(2*e.length+1),a.writeUtf16String(e),i=Memory.alloc(20),i.writePointer(a).add(4).writeU32(2*e.length).add(4).writeU32(2*e.length).add(4).writeU32(0).add(4).writeU32(0),i);const c=e=>(e=>{const t=ptr(e),r=t.add(4).readU32(),o=t.add(8).readU32();return t.ptr=t.readPointer(),t.size=r,t.capacity=o,t.ptr._readUtf16String=t.ptr.readUtf16String,t.readUtf16String=()=>t.size?t.ptr._readUtf16String(2*t.size):"",t})(e).readUtf16String(),s=()=>{let t=-1;const o=r.add(e.WX_ACCOUNT_SERVICE_OFFSET),n=new NativeFunction(o,"pointer",[])();try{if(!n.isNull()){t=n.add(1248).readU32()}}catch(e){throw new Error(e)}return t};(()=>{const t=new NativeCallback((()=>{}),"void",[]),o=new NativeFunction(t,"void",[]);Interceptor.attach(r.add(e.WX_ACCOUNT_SERVICE_OFFSET),{onLeave:function(e){const t=s();return 1!==t&&(console.log("当前登陆状态:",t),setImmediate((()=>o()))),e}});const n=()=>{1!==s()?(setImmediate((()=>o())),setTimeout(n,3e3)):setImmediate((()=>o()))};setTimeout(n,3e3)})(),(()=>{const t=new NativeCallback((()=>{}),"void",["int32"]),o=new NativeFunction(t,"void",["int32"]);try{Interceptor.attach(r.add(e.WX_LOGOUT_OFFSET),{onEnter:function(e){try{console.log("已登出:",e[0].toInt32());const t=e[0].toInt32();setImmediate((()=>o(t)))}catch(e){throw console.error("登出回调失败：",e),new Error(e)}}})}catch(e){return console.error("登出回调失败：",e),null}})();let u=!1;(()=>{const e=new NativeCallback((()=>{}),"void",[]),t=new NativeFunction(e,"void",[]),r=()=>{1===s()&&(u||(setImmediate((()=>t())),u=!0),setTimeout(r,3e3))};setTimeout(r,3e3)})();let _=null,p=null,S=null,U=null;((e,t)=>{U=Memory.alloc(2020),_=Memory.alloc(Process.pageSize),p=d(t),S=l(e),Memory.patchCode(_,Process.pageSize,(e=>{var t=new X86Writer(e,{pc:_});t.putPushfx(),t.putPushax(),t.putMovRegAddress("edi",p),t.putMovRegAddress("eax",U),t.putMovRegReg("edx","edi"),t.putPushReg("eax"),t.putMovRegAddress("ecx",S),t.putCallAddress(r.add(12611344)),t.putAddRegImm("esp",4),t.putPopax(),t.putPopfx(),t.putRet(),t.flush()}));new NativeFunction(ptr(_),"void",[])();c(U)})("tyutluyc","21341182572@chatroom");(()=>{const e=new NativeCallback((()=>{}),"void",["int32","pointer","pointer","pointer","pointer","int32"]),o=new NativeFunction(e,"void",["int32","pointer","pointer","pointer","pointer","int32"]);try{Interceptor.attach(r.add(t.WX_RECV_MSG_HOOK_OFFSET),{onEnter(){try{const e=this.context.ecx,t=e.add(56).readU32(),r=e.add(60).readU32();if(t>0){const n=e.add(72).readPointer(),d=2*e.add(76).readU32()+2,a=Memory.alloc(d);Memory.copy(a,n,d);let i=null,l=0,c=null;if(3===t){const t=e.add(408).readPointer(),r=e.add(428).readPointer(),o=t.readUtf16String(),n=r.readUtf16String(),d=[o,o,n,n],a=JSON.stringify(d);c=Memory.allocUtf16String(a)}else i=e.add(112).readPointer(),l=2*e.add(116).readU32()+2,c=Memory.alloc(l),Memory.copy(c,i,l);const s=e.add(372).readU32();let u=null;if(0===s)u=Memory.alloc(16),u.writeUtf16String("null");else{const t=e.add(372).readPointer(),r=2*e.add(376).readU32()+2;u=Memory.alloc(r),Memory.copy(u,t,r)}const _=e.add(496).readU32();let p=null;if(0===_)p=Memory.alloc(16),p.writeUtf16String("null");else{const t=e.add(496).readPointer(),r=2*e.add(500).readU32()+2;p=Memory.alloc(r),Memory.copy(p,t,r)}setImmediate((()=>o(t,a,c,u,p,r)))}}catch(e){throw console.error("接收消息回调失败：",e),new Error(e)}}})}catch(e){return console.error("回调消息失败："),null}})();